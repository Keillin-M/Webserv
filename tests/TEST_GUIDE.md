# Webserv Test Guide

## Overview

This guide describes how to run and validate all major tests for your Webserv project, including error pages, CGI, stress scenarios, scalability, redirects, and front-end validation.

---

## ğŸŒ Testing in Your Browser

You can also test the server and error handling visually using any web browser. Just start your server and navigate to:

- `http://localhost:8080/` â€” Main index page
- `http://localhost:8080/pages/` â€” Browse available frontend pages
- Try visiting non-existent URLs (e.g., `/nonexistent.html`) or forbidden paths to see custom error pages

The frontend in `www/pages/` provides user-friendly interfaces for exploring features, forms, and error handling. This is a great way to validate both backend and frontend integration.


## ğŸ“‚ Test Assets and Structure

- **Custom Error Pages**:  
	Place in `www/errors/`  
	- `www/errors/400.html` â€” Bad Request  
	- `www/errors/403.html` â€” Forbidden  
	- `www/errors/404.html` â€” Not Found  
	- `www/errors/405.html` â€” Method Not Allowed  
	- `www/errors/500.html` â€” Internal Server Error  
	- `www/errors/501.html` â€” Not Implemented  
	- `www/errors/505.html` â€” HTTP Version Not Supported  

- **Config files**:  
	- `config/default.conf` â€” Main server config (edit for different port/tests if needed)

- **Test Scripts** (run from repo root):
	- `tests/cgi_test.py` â€” CGI and Python script tests
	- `tests/full_test.sh` â€” Full integration and error page tests

- **Stress Testing with Siege**:
	- `siege -c10 -t30S http://localhost:8080/` â€” 10 concurrent users for 30 seconds
	- `siege -c20 -r100 http://localhost:8080/` â€” 20 concurrent users, 100 requests each

---

## ğŸš€ Quick Start: Full Automated Test Suite

1. **Start Webserv**
		```bash
		./webserv config/default.conf
		```

2. **Run All Tests**
		```bash
		bash tests/full_test.sh
		```

---

## ğŸ› ï¸ Running Specific Tests

You can run any script individually. Examples:

```bash
bash tests/cgi_test.py                # CGI and Python script tests
bash tests/full_test.sh               # Full integration and error page tests
```

---

## ğŸ” Manual Testing Examples

- **404 Not Found:**
		```bash
		curl -i http://localhost:8080/nonexistent.html
		```
		Should return a `404` status *and* your custom 404 HTML.

- **405 Method Not Allowed:**
		```bash
		curl -X POST http://localhost:8080/
		```

- **403 Forbidden (directory traversal):**
		```bash
		curl "http://localhost:8080/../etc/passwd"
		```

- **Bad Request (400):**
		```bash
		curl -X POST http://localhost:8080/upload
		```

- **501 Not Implemented:**
		```bash
		curl -X PATCH http://localhost:8080/
		```

---

## ğŸ“ Expected Results

- âœ… Correct HTTP status code (`404`, `403`, etc)
- âœ… Response body contains your custom error page (include a marker for script detection, e.g., `Custom error page from webserv`)
- âœ… No server crashes or resource leaks under stress

## ğŸ CGI Tests

You can test CGI script execution using curl or your browser. Example:

- **Python CGI (curl):**
	```bash
	curl -i http://localhost:8080/cgi-bin/py/hello.py
	curl -i http://localhost:8080/cgi-bin/py/env.py
	```
	You should see output generated by the Python scripts.

- **PHP CGI (curl):**
	```bash
	curl -i http://localhost:8080/cgi-bin/php/hello.php
	```

- **In the browser:**
	- Visit `http://localhost:8080/cgi-bin/py/hello.py` or similar URLs to see CGI output rendered in your browser.

If a script is missing or fails, you should see the appropriate error page (e.g., 404 or 500).

## ğŸ”€ Redirection Tests

You can test HTTP redirection responses using curl or your browser. Example:

- **301/302/307 Redirect (curl):**
	```bash
	curl -i http://localhost:8080/redirect-301
	curl -i http://localhost:8080/redirect-302
	curl -i http://localhost:8080/redirect-307
	```
	You should see a `Location:` header and the appropriate status code (301, 302, or 307).

- **In the browser:**
	- Visit `http://localhost:8080/redirect-302` or similar URLs. You should be redirected to the target page (e.g., `/pages/about.html`).

---

## â˜‘ï¸ Tips and Troubleshooting

- **If tests fail with â€œdefault error pageâ€:**  
	- Ensure all needed HTML files are present and readable in `www/errors/`.
	- Check your webserv config error_page directives match those files.
	- The server process must have permissions to read them.
	- Double-check your server actually loads and returns these files on error.

- **If CGI/POST/Uploads fail:**  
	- Confirm scripts in `www/cgi-bin/` are present and executable and `cgi_path`/`cgi_extension` in config is correct.
	- Validate your config for allowed methods in location blocks.
